{% extends "base.html" %}

{% block title %}Student Dashboard - Basque LMS{% endblock %}

{% block content %}
<h1>Welcome, {{ current_user.username }}</h1>

{% if upcoming_assignments %}
<div class="reminder-section" style="background-color: #0c0a02; border: 1px solid #ffc107; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
    <h2 style="color: #856404;">Upcoming Assignment Reminders</h2>
    <p>You have assignments due within the next 7 days:</p>
    <ul>
        {% for assignment in upcoming_assignments %}
        <li style="margin-bottom: 10px;">
            <strong>{{ assignment.title }}</strong> - 
            Due: {{ assignment.due_date.strftime('%B %d, %Y at %I:%M %p') }}
            {% set days_left = (assignment.due_date - now).days %}
            {% if days_left == 0 %}
                <span style="color: red; font-weight: bold;">(Due Today!)</span>
            {% elif days_left == 1 %}
                <span style="color: orange; font-weight: bold;">(Due Tomorrow!)</span>
            {% else %}
                <span style="color: #856404;">({{ days_left }} days left)</span>
            {% endif %}
            {% if assignment.id not in submitted_ids %}
                <a href="{{ url_for('student.submit_assignment', assignment_id=assignment.id) }}" style="margin-left: 10px;">Submit</a>
            {% else %}
                <span style="color: green;">(Submitted)</span>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<h2>All Assignments</h2>
{% if all_assignments %}
<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
    <thead>
        <tr style="background-color: #0c0a02;">
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Assignment</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Due Date</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Status</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Grade</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for assignment in all_assignments %}
        <tr>
            <td style="padding: 10px; border: 1px solid #dee2e6;">{{ assignment.title }}</td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">{{ assignment.due_date.strftime('%B %d, %Y at %I:%M %p') }}</td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">
                {% if assignment.id in submitted_ids %}
                    <span style="color: green;">Submitted</span>
                {% else %}
                    <span style="color: orange;">Pending</span>
                {% endif %}
            </td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">
                {% for sub in my_submissions if sub.assignment_id == assignment.id %}
                    {% if sub.grade is not none %}
                        {{ sub.grade }}/100
                        {% if sub.feedback %}
                            <br><small>Feedback: {{ sub.feedback }}</small>
                        {% endif %}
                    {% else %}
                        <span style="color: gray;">Not graded</span>
                    {% endif %}
                {% else %}
                    -
                {% endfor %}
            </td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">
                {% if assignment.id not in submitted_ids %}
                    <a href="{{ url_for('student.submit_assignment', assignment_id=assignment.id) }}">Submit</a>
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No assignments available at this time.</p>
{% endif %}

<h2>Your Grades</h2>
{% if my_submissions %}
<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
    <thead>
        <tr style="background-color: #f8f9fa;">
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Assignment</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Grade</th>
            <th style="padding: 10px; border: 1px solid #dee2e6; text-align: left;">Feedback</th>
        </tr>
    </thead>
    <tbody>
        {% for submission in my_submissions %}
        <tr>
            <td style="padding: 10px; border: 1px solid #dee2e6;">{{ submission.assignment.title }}</td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">
                {% if submission.grade is not none %}
                    {{ submission.grade }}/100
                {% else %}
                    <span style="color: gray;">Not graded yet</span>
                {% endif %}
            </td>
            <td style="padding: 10px; border: 1px solid #dee2e6;">
                {% if submission.feedback %}
                    {{ submission.feedback }}
                {% else %}
                    -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>You haven't submitted any assignments yet.</p>
{% endif %}
{% endblock %}
